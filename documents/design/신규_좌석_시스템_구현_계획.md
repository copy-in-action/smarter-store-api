# 신규 좌석 시스템(JSON) 구현 계획 분석

이 문서는 프론트엔드 개발자의 "좌석 등록 방식 JSON으로 변경" 제안을 수용할 경우, 새롭게 구현해야 할 백엔드 시스템의 범위와 아키텍처를 분석한 내용입니다.

## 1. 결론: 광범위한 신규 개발 및 아키텍처 변경

제안된 JSON 방식을 도입할 경우, 이는 단순 기능 개선이 아닌 **프로젝트의 좌석 관련 핵심 도메인과 비즈니스 로직 전반을 새롭게 설계하고 구현**하는 중대한 아키텍처 변경입니다.

## 2. 신규 구현 영역 상세 분석

### 2.1. 데이터 모델 및 DB 구조 설계

*   **`Venue` 엔티티 설계:**
    *   공연장의 좌석 배치 정보 전체(행/열, 등급, 벽, 복도 등)를 담을 **JSON 타입의 새로운 컬럼** (예: `seatingChartJson`)을 추가해야 합니다.
*   **`ScheduleSeat` 엔티티 신규 설계:**
    *   회차별 개별 좌석의 상태(예매, 점유 등)를 관리할 `ScheduleSeat` 엔티티를 새롭게 설계해야 합니다.
    *   이 엔티티는 특정 좌석을 식별하기 위해 `section`, `row`, `number` 등의 정보를 컬럼으로 직접 가져야 합니다. 이를 통해 `Venue`의 좌석 JSON 정보와 `ScheduleSeat`의 상태 정보를 논리적으로 연결합니다.

### 2.2. 핵심 비즈니스 로직 구현

*   **`SeatChartService` 구현:**
    *   공연장(Venue)의 좌석 배치 JSON을 **생성/수정/검증**하는 로직을 구현합니다. 관리자가 좌석 에디터에서 "저장"을 눌렀을 때, 유효한 좌석 배치 JSON을 만들어 `Venue`에 저장하는 기능이 핵심입니다.
*   **`ScheduleSeatService` 구현:**
    *   **좌석 초기화 로직:** 특정 공연 회차에 대해, `Venue`의 **JSON을 파싱**하여 그 안에 정의된 모든 좌석에 대한 `ScheduleSeat` 레코드를 생성하는 로직을 구현해야 합니다.
    *   **좌석 조회 로직:** `Venue`의 좌석 배치 JSON 정보(모양, 위치)와 `ScheduleSeat` 테이블의 상태 정보(예매 가능/점유/완료)를 **실시간으로 조합**하여 프론트엔드에 전달하는 로직이 필요합니다.
*   **좌석 상태 관리 서비스 (`SeatHoldService`, `SeatReservationService`) 구현:**
    *   사용자가 특정 좌석을 클릭했을 때, 해당 `ScheduleSeat`를 찾아 상태를 변경(점유, 예매 완료)하는 로직을 구현합니다.

### 2.3. API 명세 및 DTO 설계

*   **좌석 배치 관리 API 설계:**
    *   공연장의 좌석 배치 JSON 전체를 저장/수정하는 새로운 API(예: `PUT /venues/{id}/seating-chart`)를 설계하고 구현해야 합니다.
    *   해당 API의 요청 DTO는 좌석 배치 JSON 구조 전체를 담도록 설계합니다.
*   **관련 DTO 신규 설계:**
    *   JSON 구조에 맞는 새로운 DTO들을 설계하고 구현해야 합니다.

---

## 3. 요약: 장점과 단점

*   **예상 장점:**
    *   프론트엔드에서 좌석 배치도를 렌더링하는 로직이 단순해질 수 있습니다.
    *   좌석 배치 정보 전체를 한 번의 API 호출로 가져올 수 있습니다.

*   **예상 단점 및 위험:**
    *   **백엔드 복잡성 급증:** 관계형 데이터베이스에서 JSON 데이터를 파싱하고, 개별 상태 테이블과 조합하는 로직은 매우 복잡하며 성능 저하를 유발할 수 있습니다.
    *   **데이터 정합성 문제:** 좌석의 구조(JSON)와 상태(테이블)가 분리되어 데이터가 어긋날 위험이 커집니다.
    *   **확장성 저하:** "특정 등급의 좌석 수만 세기", "특정 구역의 좌석만 조회하기" 등 좌석에 대한 다양한 조건의 쿼리 성능이 크게 저하됩니다.
    *   **개발 공수:** 기존에 구현되었던 백엔드의 좌석 관련 로직을 폐기하고 새로 작성해야 합니다.

---

## 4. 권장 사항

이 변경은 단순한 기능 개선이 아닌, 프로젝트의 **핵심 데이터 아키텍처를 변경하는 중대한 결정**입니다.

따라서 이 제안을 수용하기에 앞서, **JSON 기반 설계의 장단점과 현재 아키텍처에 미치는 영향을 분석하는 심도 깊은 기술 검토**가 반드시 선행되어야 합니다. 경우에 따라서는 간단한 프로토타입을 만들어 성능과 구현 복잡성을 미리 검증해볼 필요가 있습니다.
