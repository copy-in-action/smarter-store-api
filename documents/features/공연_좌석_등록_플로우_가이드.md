# 공연/좌석 등록 플로우 가이드

## 개요

이 문서는 관리자가 공연을 등록하고 예매를 오픈하기까지의 전체 흐름을 설명합니다.
프론트엔드 개발자와 협의하여 최적의 UI/UX를 설계하기 위한 참고 자료입니다.

---

## 전체 등록 흐름

```
┌─────────────────────────────────────────────────────────────────────┐
│  1. 공연장(Venue) 등록                                               │
│     - 공연장 이름, 주소                                              │
│     - 좌석배치도 이미지 URL (선택)                                    │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  2. 좌석(Seat) 등록                                                  │
│     - 공연장에 속한 좌석 마스터 데이터                                 │
│     - 구역, 열, 번호, 등급, 좌표(x, y)                                │
│     ※ 공연장마다 1회만 등록하면 됨 (재사용)                            │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  3. 공연(Performance) 등록                                           │
│     - 공연 정보 (제목, 설명, 카테고리 등)                              │
│     - 공연장 선택 (venueId)                                          │
│     - 티켓 옵션 등록 (좌석등급별 가격)                                 │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  4. 공연 회차(Schedule) 등록                                         │
│     - 공연 일시, 판매 시작 일시                                       │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  5. 회차별 좌석(ScheduleSeat) 초기화                                  │
│     - 공연장 좌석을 해당 회차에 복사                                   │
│     - 좌석등급 ↔ 티켓옵션(가격) 매핑                                   │
│     - 모든 좌석 상태: AVAILABLE                                       │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  6. 공연 노출 (visible = true)                                       │
│     - 사용자에게 공연 공개                                            │
│     - 예매 시작                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 단계별 상세 설명

### 1단계: 공연장 등록

공연이 진행될 장소를 등록합니다.

```
POST /api/admin/venues
{
  "name": "올림픽공원 올림픽홀",
  "address": "서울시 송파구 올림픽로 424",
  "seatingChartUrl": null  // 좌석 등록 후 업데이트 가능
}
```

**seatingChartUrl 관련 협의 필요:**
- 현재 구조: 좌석배치도 이미지 URL을 저장하는 필드
- 질문: 이 이미지가 실제로 필요한가?
  - 옵션 A: 정적 이미지만 표시 (단순 참고용)
  - 옵션 B: FE에서 좌석 데이터로 동적 렌더링 (이미지 불필요)
  - 옵션 C: 이미지 위에 좌석 클릭 영역 오버레이

---

### 2단계: 좌석 등록

공연장에 속한 좌석을 등록합니다. **공연장당 1회만 등록하면 모든 공연에서 재사용됩니다.**

#### 단일 등록
```
POST /api/admin/venues/{venueId}/seats
{
  "section": "1층",       // 구역명 (자유 형식)
  "row": "A",             // 열 (자유 형식: A, B, 1, 2, VIP1 등)
  "number": 1,            // 좌석 번호 (1 이상 정수)
  "seatGrade": "VIP",     // 등급: VIP, PREMIUM, STANDARD, ACCESSIBLE
  "positionX": 100,       // 좌석배치도 X좌표
  "positionY": 50         // 좌석배치도 Y좌표
}
```

#### 일괄 등록
```
POST /api/admin/venues/{venueId}/seats/bulk
{
  "seats": [
    { "section": "1층", "row": "A", "number": 1, "seatGrade": "VIP", "positionX": 100, "positionY": 50 },
    { "section": "1층", "row": "A", "number": 2, "seatGrade": "VIP", "positionX": 130, "positionY": 50 },
    { "section": "1층", "row": "A", "number": 3, "seatGrade": "VIP", "positionX": 160, "positionY": 50 },
    ...
  ]
}
```

#### 필드 설명

| 필드 | 설명 | 예시 |
|------|------|------|
| section | 구역명. 좌석배치도에서 그룹핑 단위 | "1층", "2층", "VIP구역", "스탠딩A" |
| row | 좌석 열. 같은 줄에 있는 좌석들 | "A", "B", "1", "2", "VIP1" |
| number | 좌석 번호. 열 내에서 유일해야 함 | 1, 2, 3, ... |
| seatGrade | 좌석 등급. 가격 책정에 사용 | VIP, PREMIUM, STANDARD, ACCESSIBLE |
| positionX | 좌석배치도에서의 X좌표 | 100 (픽셀) |
| positionY | 좌석배치도에서의 Y좌표 | 50 (픽셀) |

#### 좌표(positionX, positionY) 설명

좌석배치도를 렌더링할 때 사용하는 좌표입니다.

```
     0                    400                   800
     ├──────────────────────┼──────────────────────┤ → X축
   0 ┌─────────────────────────────────────────────┐
     │                  [ 무 대 ]                   │
  50 ├─────────────────────────────────────────────┤
     │  (100,80)  (130,80)  (160,80)  ...          │  A열
 100 │  (100,110) (130,110) (160,110) ...          │  B열
 150 │  (100,140) (130,140) (160,140) ...          │  C열
     │                                             │
 400 └─────────────────────────────────────────────┘
     ↓
     Y축
```

**협의 필요:**
- 좌표 단위: 픽셀(px)? 상대값(%)?
- 좌석 크기: 고정값? 줌 레벨에 따라 가변?
- 좌석 간격: BE에서 계산? FE에서 자유 배치?

---

### 3단계: 공연 등록

```
POST /api/admin/performances
{
  "title": "2025 HYOLYN CONCERT",
  "description": "효린 단독 콘서트",
  "category": "CONCERT",
  "runningTime": 120,
  "ageRating": "전체 관람가",
  "venueId": 1,
  "startDate": "2025-12-25",
  "endDate": "2025-12-26"
}
```

#### 티켓 옵션 등록 (좌석등급별 가격)

```
POST /api/admin/performances/{performanceId}/ticket-options
{
  "name": "VIP석",
  "price": 150000,
  "totalQuantity": 100  // 해당 등급 총 좌석수
}
```

```
POST /api/admin/performances/{performanceId}/ticket-options
{
  "name": "R석",
  "price": 120000,
  "totalQuantity": 200
}
```

---

### 4단계: 공연 회차 등록

```
POST /api/admin/performances/{performanceId}/schedules
{
  "showDatetime": "2025-12-25T14:00:00",
  "saleStartDatetime": "2025-12-01T10:00:00"
}
```

---

### 5단계: 회차별 좌석 초기화

공연장의 좌석(Seat)을 해당 회차의 좌석(ScheduleSeat)으로 복사합니다.
좌석등급(seatGrade)과 티켓옵션(ticketOption)을 매핑합니다.

```
POST /api/admin/schedules/{scheduleId}/seats/initialize
{
  "seatGradeMapping": {
    "VIP": 1,       // VIP 등급 좌석 → ticketOptionId 1 (VIP석 15만원)
    "PREMIUM": 2,   // PREMIUM 등급 → ticketOptionId 2 (R석 12만원)
    "STANDARD": 3,  // STANDARD 등급 → ticketOptionId 3 (S석 9만원)
    "ACCESSIBLE": 3 // 장애인석 → ticketOptionId 3 (S석 가격 적용)
  }
}
```

---

### 6단계: 공연 노출

```
PATCH /api/admin/performances/{performanceId}
{
  "visible": true
}
```

---

## FE 협의가 필요한 부분

### 1. 좌석배치도 렌더링 방식

| 옵션 | 설명 | 장점 | 단점 |
|------|------|------|------|
| A. 정적 이미지 | seatingChartUrl 이미지만 표시 | 단순함 | 좌석 클릭 불가 |
| B. SVG 동적 생성 | positionX/Y로 좌석 렌더링 | 인터랙티브 | FE 구현 복잡 |
| C. 이미지 + 오버레이 | 이미지 위에 클릭 영역 배치 | 실제감 | 좌표 맞추기 어려움 |

**현재 BE 설계는 옵션 B (SVG 동적 생성)를 가정하고 있습니다.**

### 2. 좌석 등록 UI

좌석을 어떻게 등록할 것인가?

| 옵션 | 설명 |
|------|------|
| A. 수동 입력 | 관리자가 직접 좌표 입력 (비효율) |
| B. 드래그 앤 드롭 | 캔버스에서 좌석 배치 (FE 구현 복잡) |
| C. CSV/Excel 업로드 | 미리 작성된 데이터 일괄 등록 |
| D. 템플릿 생성 | "10x20 그리드" 같은 패턴으로 자동 생성 |

### 3. 줌/팬 기능

대형 공연장(수천 석)의 경우 줌/팬 기능이 필수입니다.

- 사용할 라이브러리?
- 줌 레벨에 따른 좌석 표시 방식?
- 모바일 터치 지원?

### 4. 좌석 상태 표시

```
┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
│ AVAILABLE│  │  HELD   │  │ RESERVED │  │ACCESSIBLE│
│  (회색)  │  │ (노란색) │  │  (빨간색) │  │  (파란색) │
│ 선택가능 │  │ 선택중  │  │ 예매완료 │  │ 장애인석 │
└─────────┘  └─────────┘  └─────────┘  └─────────┘
```

### 5. 실시간 업데이트

다른 사용자가 좌석을 선택하면 실시간으로 반영되어야 합니다.

```
GET /api/schedules/{scheduleId}/seats/events  (SSE)
```

---

## 데이터 관계도

```
Venue (공연장)
  │
  ├── seatingChartUrl (좌석배치도 이미지)
  │
  └── Seat (좌석 마스터) ─────────────────────────┐
        - section: "1층"                         │
        - row: "A"                               │
        - number: 1                              │
        - seatGrade: VIP                         │
        - positionX: 100                         │
        - positionY: 50                          │
                                                 │
Performance (공연)                                │
  │                                              │
  ├── venueId → Venue                            │
  │                                              │
  ├── TicketOption (티켓 옵션)                    │
  │     - name: "VIP석"                          │
  │     - price: 150000                          │
  │                                              │
  └── PerformanceSchedule (회차)                  │
        │                                        │
        └── ScheduleSeat (회차별 좌석) ←──────────┘
              - seatId → Seat (복사)
              - ticketOptionId → TicketOption
              - status: AVAILABLE/HELD/RESERVED
              - heldUntil: (점유 만료 시간)
```

---

## 질문/논의 사항

1. **좌석배치도 이미지(seatingChartUrl)가 필요한가?**
   - FE에서 SVG로 동적 생성하면 불필요할 수 있음

2. **좌석 좌표를 어떻게 설정할 것인가?**
   - BE에서 템플릿으로 자동 생성?
   - FE에서 드래그 앤 드롭 에디터 제공?
   - Excel 등 외부 도구로 작성 후 업로드?

3. **줌/팬 기능에 사용할 라이브러리?**
   - react-zoom-pan-pinch
   - d3.js
   - Konva.js
   - 기타

4. **모바일 지원 범위?**
   - 좌석 선택 UI가 모바일에서도 동작해야 하는가?
   - 터치 제스처 지원 필요?

5. **관리자용 좌석 에디터 우선순위?**
   - MVP: CSV 업로드 또는 API 직접 호출
   - 이후: 드래그 앤 드롭 에디터 개발
