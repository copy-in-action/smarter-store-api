# 예매 내역 조회 가이드

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0  | 2026-02-07 | Gemini | 마이페이지 및 관리자용 예매 목록 조회 명세 추가 |

## 1. 개요
사용자가 자신의 과거 예매 및 취소 이력을 확인하거나, 관리자가 특정 공연 회차의 전체 예매 현황을 모니터링하기 위한 API 가이드입니다.

---

## 2. 사용자용 예매 내역 (마이페이지)

사용자는 본인이 예매한 내역(확정 및 취소)을 최신순으로 확인할 수 있습니다.

- **API**: `GET /api/bookings/me`
- **권한**: `ROLE_USER`
- **주요 응답 필드**:
    - `performanceTitle`: 공연 제목
    - `showDateTime`: 공연 일시
    - `status`: 예매 상태 (`CONFIRMED`, `CANCELLED`)
    - `seatSummary`: "A구역 1행 1열" 형태의 요약 문자열
    - `totalPrice`: 총 결제 금액

---

## 3. 관리자용 회차별 예매 목록

관리자는 특정 회차를 선택하여 해당 회차에 발생한 모든 예매와 결제 상태를 상세히 조회할 수 있습니다.

- **API**: `GET /api/admin/bookings/schedules/{scheduleId}`
- **권한**: `ROLE_ADMIN`
- **주요 응답 필드**:
    - **예매 정보**: 번호, 상태, 총액, 좌석 요약
    - **사용자 정보**: 이메일, 이름, 연락처(마스킹 해제됨)
    - **결제 정보**: 결제 상태(`COMPLETED`, `CANCELLED`, `REFUNDED` 등), 결제 수단, 완료/환불 시각

---

## 4. 데이터 정합성 가이드

1. **상태 동기화**: `CONFIRMED` 상태의 예매는 반드시 연결된 `Payment`가 존재해야 합니다.
2. **N+1 방지**: 관리자용 목록 조회 시, 다수의 예매 건에 대한 결제 정보를 한꺼번에 조회(Bulk Fetch)하여 성능을 최적화하고 있습니다.
3. **보안**: 
    - 사용자 API는 본인의 데이터만 노출합니다.
    - 관리자 API는 고객 지원을 위해 연락처 등 상세 정보를 포함합니다.
