# 예매 내역 조회 가이드

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0  | 2026-02-07 | Gemini | 마이페이지 및 관리자용 예매 목록 조회 명세 추가 |

## 1. 개요
사용자가 자신의 과거 예매 및 취소 이력을 확인하거나, 관리자가 특정 공연 회차의 전체 예매 현황을 모니터링하기 위한 API 가이드입니다.

---

## 2. 사용자용 예매 내역 및 상세 조회 (마이페이지)

사용자는 본인이 예매한 내역을 목록으로 보거나, 특정 예매 건의 상세 정보를 확인할 수 있습니다.

### 2.1. 내 예매 목록 조회
- **API**: `GET /api/bookings/me`
- **권한**: `ROLE_USER`
- **주요 응답 필드**: 공연 제목, 일시, 상태, 좌석 요약, 총 결제 금액

### 2.2. 내 예매 상세 조회
- **API**: `GET /api/bookings/{bookingId}`
- **권한**: `ROLE_USER` (본인 소유 확인)
- **주요 응답 필드**:
    - **공연/예매 기본 정보**: 제목, 이미지, 번호, 상태, 일시 등
    - **좌석 상세 목록**: 선택한 모든 좌석의 위치, 등급, 가격
    - **결제 상세 정보**: 결제 번호, 수단, 상태, 완료 시각, 카드 정보 등 (결제 완료 시에만 포함)

---

## 3. 관리자용 예매 내역 및 상세 조회

관리자는 전체 예매 현황을 모니터링하고 개별 예매 건의 상세 데이터를 확인할 수 있습니다.

### 3.1. 회차별 예매 목록 조회
- **API**: `GET /api/admin/bookings/schedules/{scheduleId}`
- **권한**: `ROLE_ADMIN`
- **주요 응답 필드**: 예매자 정보(이메일, 이름, 연락처), 예매 상태, 결제 상태 및 내역

### 3.2. 단건 예매 상세 조회
- **API**: `GET /api/admin/bookings/{bookingId}`
- **권한**: `ROLE_ADMIN`
- **주요 응답 필드**: 사용자 정보(이메일, 이름)를 포함한 예매 및 결제의 모든 상세 데이터

---

## 4. 데이터 정합성 가이드

1. **상태 동기화**: `CONFIRMED` 상태의 예매는 반드시 연결된 `Payment`가 존재해야 합니다.
2. **N+1 방지**: 관리자용 목록 조회 시, 다수의 예매 건에 대한 결제 정보를 한꺼번에 조회(Bulk Fetch)하여 성능을 최적화하고 있습니다.
3. **보안**: 
    - 사용자 API는 본인의 데이터만 노출합니다.
    - 관리자 API는 고객 지원을 위해 연락처 등 상세 정보를 포함합니다.
