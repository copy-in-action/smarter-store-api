# 보안 가이드

## 1. 개요

Spring Security + JWT 기반 Stateless 인증/인가 시스템입니다.

JWT 토큰 상세 내용은 [JWT_토큰_가이드.md](./JWT_토큰_가이드.md) 참조.

## 2. 주요 파일

| 파일 | 역할 |
|:---|:---|
| `config/SecurityConfig.kt` | Security 설정 (인가 규칙, CORS, 필터 등록) |
| `config/jwt/JwtTokenProvider.kt` | 토큰 생성, 검증, 파싱 |
| `config/jwt/JwtAuthenticationFilter.kt` | 요청 헤더에서 토큰 추출 및 인증 처리 |
| `service/CustomUserDetailsService.kt` | DB에서 사용자 정보 로드 |

## 3. 인가 규칙

### 인증 없이 접근 가능 (permitAll)
- `/api/auth/**` - 사용자 인증 API
- `/api/admin/auth/**` - 관리자 인증 API
- `/swagger-ui/**`, `/v3/api-docs/**` - API 문서
- `/actuator/health` - 헬스체크

### 인증 필요
- 그 외 모든 요청

### 메서드 수준 권한 제어
```kotlin
@PreAuthorize("hasRole('ADMIN')")
fun adminOnly() { ... }

@PreAuthorize("hasAnyRole('USER', 'ADMIN')")
fun userOrAdmin() { ... }
```

## 4. CORS 설정

### 설정 위치
- `config/SecurityConfig.kt` - CORS 설정 Bean
- `application-*.yml` - 환경별 Origin 설정

### 환경별 설정

**application-local.yml**
```yaml
cors:
  allowed-origins: http://localhost:3000, http://localhost:5173, http://127.0.0.1:3000, http://127.0.0.1:5173
```

**application-prod.yml**
```yaml
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000, http://localhost:5173, http://127.0.0.1:3000, http://127.0.0.1:5173}
```

프로덕션 배포 시 `CORS_ALLOWED_ORIGINS` 환경변수로 실제 도메인 설정.

### 기본 허용 설정

| 항목 | 값 |
|:---|:---|
| Methods | GET, POST, PUT, DELETE, PATCH, OPTIONS |
| Headers | * |
| Credentials | true |
| Max Age | 3600초 |

## 5. 비밀번호 암호화

`BCryptPasswordEncoder` 사용. 회원가입 시 자동 암호화.

```kotlin
@Bean
fun passwordEncoder(): PasswordEncoder = BCryptPasswordEncoder()
```
