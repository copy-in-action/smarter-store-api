# JWT 인증 및 보안 전략 가이드

## 개정이력

| 버전 | 일자 | 작성자 | 내용 |
|------|------|--------|------|
| 1.0 | 2025-12-29 | Gemini | 초기 보안 전략 수립 및 문서화 |

---

이 문서는 `smarter-store-api` 프로젝트의 JWT(JSON Web Token) 기반 인증 시스템과 보안 전략에 대해 설명합니다.

## 1. 개요: 쿠키 기반 이중 토큰 전략

보안 위협(XSS 등)을 완화하기 위해 다음과 같은 전략을 사용합니다.

- **Access Token (단기, 1시간)**: 실제 API 인증에 사용.
- **Refresh Token (장기, 7일)**: Access Token 재발급용.
- **`HttpOnly` 쿠키 저장**: JavaScript에서 접근 불가능하게 설정하여 XSS 방어.
- **`Secure` 및 `SameSite` 속성**: HTTPS 강제 및 CSRF 방어.

## 2. 전체 인증 흐름

### 2.1. 로그인 (`POST /api/auth/login`)
서버는 인증 성공 시 Access Token과 Refresh Token을 브라우저 쿠키로 설정합니다.

### 2.2. API 요청
브라우저는 요청 시 자동으로 `Cookie` 헤더에 토큰을 담아 전송하며, 서버의 `JwtAuthenticationFilter`가 이를 검증합니다.

### 2.3. 토큰 갱신 (`POST /api/auth/refresh`)
Access Token 만료 시 401 에러를 반환하며, 프론트엔드는 Refresh Token을 사용하여 새로운 토큰을 발급받습니다 (Token Rotation 적용).

## 3. 상세 구조

- **Access Token**: 표준 JWT 형식 (Payload에 이메일, 권한 포함).
- **Refresh Token**: 암호학적으로 안전한 랜덤 UUID 문자열 (DB 저장 및 Token Rotation 적용).

## 4. 프론트엔드 가이드

- **토큰 직접 저장 금지**: `localStorage` 사용 지양.
- **API 요청 설정**: `credentials: 'include'` (Fetch) 또는 `withCredentials: true` (Axios) 필수 설정.
- **Authorization 헤더**: 쿠키를 사용하므로 수동으로 헤더를 추가할 필요 없음.